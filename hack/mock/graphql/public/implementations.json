[
  {
    "name": "install",
    "prefix": "cap.implementation.attlasian.jira",
    "path": "cap.implementation.attlasian.jira.install",
    "revisions": [
      {
        "metadata": {
          "description": "Action which installs Jira via Helm chart",
          "displayName": "Install Jira",
          "documentationURL": "https://github.com/javimox/helm-charts/tree/master/charts/jira-software",
          "iconURL": "https://www.atlassian.com/pl/dam/jcr:e33efd9e-e0b8-4d61-a24d-68a48ef99ed5/Jira%20Software@2x-blue.png",
          "maintainers": [
            {
              "name": "Voltron Dev Team",
              "email": "team-dev@projectvoltron.dev",
              "url": "https://projectvoltron.dev"
            }
          ],
          "name": "install",
          "prefix": "cap.implementation.attlasian.jira",
          "path": "cap.implementation.attlasian.jira.install",
          "supportURL": " https://mox.sh/helm",
          "attributes": []
        },
        "revision": "0.1.0",
        "spec": {
          "action": {
            "runnerInterface": "cap.interface.runner.argo",
            "args": {
              "workflow": {
                "entrypoint": "jira",
                "templates": [
                  {
                    "name": "jira",
                    "steps": [
                      [
                        {
                          "name": "generate-artifacts",
                          "template": "fetch-type-instances"
                        }
                      ],
                      [
                        {
                          "name": "postgresql-install",
                          "template": "postgresql-install",
                          "arguments": {
                            "artifacts": [
                              {
                                "name": "cloudsql",
                                "from": "{{steps.generate-artifacts.outputs.artifacts.cloudsql}}"
                              }
                            ]
                          }
                        }
                      ],
                      [
                        {
                          "name": "produce-helm-values",
                          "template": "produce-helm-values",
                          "arguments": {
                            "artifacts": [
                              {
                                "name": "cloudsql",
                                "from": "{{steps.postgresql-install.outputs.artifacts.additional}}"
                              }
                            ]
                          }
                        }
                      ],
                      [
                        {
                          "name": "jira-install",
                          "template": "jira-install",
                          "arguments": {
                            "artifacts": [
                              {
                                "name": "jira-helm-input",
                                "from": "{{steps.generate-artifacts.outputs.artifacts.jira-helm}}"
                              },
                              {
                                "name": "jira-helm-values",
                                "from": "{{steps.produce-helm-values.outputs.artifacts.jira-helm-values}}"
                              }
                            ]
                          }
                        }
                      ],
                      [
                        {
                          "name": "upload-type-instances",
                          "template": "upload-type-instances",
                          "arguments": {
                            "artifacts": [
                              {
                                "name": "jira-output",
                                "from": "{{steps.jira-install.outputs.artifacts.additional}}"
                              }
                            ]
                          }
                        }
                      ]
                    ]
                  },
                  {
                    "name": "fetch-type-instances",
                    "container": {
                      "image": "gcr.io/projectvoltron/pr/voltron-helper:PR-136",
                      "imagePullPolicy": "Always"
                    },
                    "outputs": {
                      "artifacts": [
                        {
                          "name": "cloudsql",
                          "path": "/out/cloudsql-input.yaml"
                        },
                        {
                          "name": "jira-helm",
                          "path": "/out/jira-cloud-input.yaml"
                        }
                      ]
                    }
                  },
                  {
                    "name": "postgresql-install",
                    "container": {
                      "image": "gcr.io/projectvoltron/pr/cloudsql-runner:PR-72",
                      "env": [
                        {
                          "name": "RUNNER_INPUT_PATH",
                          "value": "/input.yaml"
                        },
                        {
                          "name": "RUNNER_LOGGER_DEV_MODE",
                          "value": "true"
                        }
                      ],
                      "volumeMounts": [
                        {
                          "name": "gcp-credentials",
                          "mountPath": "/etc/gcp"
                        }
                      ]
                    },
                    "inputs": {
                      "artifacts": [
                        {
                          "name": "cloudsql",
                          "path": "/input.yaml"
                        }
                      ]
                    },
                    "outputs": {
                      "artifacts": [
                        {
                          "name": "instance",
                          "path": "/instance.yaml"
                        },
                        {
                          "name": "additional",
                          "path": "/additional.yaml"
                        }
                      ]
                    }
                  },
                  {
                    "name": "produce-helm-values",
                    "inputs": {
                      "artifacts": [
                        {
                          "name": "cloudsql",
                          "path": "/input.yaml"
                        }
                      ]
                    },
                    "outputs": {
                      "artifacts": [
                        {
                          "name": "jira-helm-values",
                          "globalName": "jira-helm-values",
                          "path": "/out/jira-cloud-values.yaml"
                        }
                      ]
                    },
                    "container": {
                      "image": "gcr.io/projectvoltron/pr/voltron-helper:PR-136",
                      "command": [
                        "/produce-helm-cloud-values.sh"
                      ],
                      "args": [
                        "--input",
                        "postgresql={{`{{ inputs.artifacts.postgresql.path }}`}}",
                        "--input",
                        "params={{ inputParametersToArtifact.path }}",
                        "--output-path",
                        "{{`{{workflow.outputs.artifacts.postgresql}}`}}",
                        "--output-format",
                        "image:\n  tag: {{ .Context.appVersion }}\npostgresql:\n  enabled: false # do not install Postgres along the Jira installation\ndatabaseConnection:\n  host: {{`{{ .postgresql.host }}`}}\n  port: {{`{{ .postgresql.port }}`}}\n  user: {{`{{ .postgresql.superuser.username }}`}}\n  password: {{`{{ .postgresql.superuser.password }}`}}\n  database: {{`{{ .postgresql.defaultDBName }}`}}\ningress:\n  enabled: true\n  ingress:\n    hosts:\n      - host: {{`{{ .params.host }}`}}\n        paths: []\n"
                      ]
                    }
                  },
                  {
                    "name": "jira-install",
                    "container": {
                      "image": "gcr.io/projectvoltron/pr/helm-runner:PR-62",
                      "env": [
                        {
                          "name": "RUNNER_INPUT_PATH",
                          "value": "/input.yaml"
                        },
                        {
                          "name": "RUNNER_LOGGER_DEV_MODE",
                          "value": "true"
                        }
                      ]
                    },
                    "inputs": {
                      "artifacts": [
                        {
                          "name": "jira-helm-input",
                          "path": "/input.yaml"
                        },
                        {
                          "name": "jira-helm-values",
                          "path": "/values.yaml"
                        }
                      ]
                    },
                    "outputs": {
                      "artifacts": [
                        {
                          "name": "release",
                          "path": "/release.yaml"
                        },
                        {
                          "name": "additional",
                          "path": "/additional.yaml"
                        }
                      ]
                    }
                  },
                  {
                    "name": "upload-type-instances",
                    "container": {
                      "image": "gcr.io/projectvoltron/pr/voltron-helper:PR-136",
                      "command": [
                        "/upload-type-instances.sh"
                      ],
                      "args": [
                        "cloudsql"
                      ]
                    },
                    "inputs": {
                      "artifacts": [
                        {
                          "name": "jira-output",
                          "path": "/input.yaml"
                        }
                      ]
                    }
                  }
                ]
              }
            }
          },
          "appVersion": "8.x.x",
          "additionalInput": {
            "typeInstances": [
              {
                "name": "db",
                "typeRef": {
                  "path": "cap.type.database.postgresql.config",
                  "revision": "0.1.0"
                },
                "verbs": [
                  "get"
                ]
              }
            ]
          },
          "additionalOutput": {
            "typeInstances": [
              {
                "name": "db",
                "typeRef": {
                  "path": "cap.type.database.postgresql.database",
                  "revision": "0.1.0"
                }
              },
              {
                "name": "postgresql",
                "typeRef": {
                  "path": "cap.type.database.postgresql.config",
                  "revision": "0.1.0"
                }
              },
              {
                "name": "helm-release",
                "typeRef": {
                  "path": "cap.type.helm.chart.release",
                  "revision": "0.1.0"
                }
              }
            ],
            "typeInstanceRelations": [
              {
                "typeInstanceName": "jira-config",
                "uses": [
                  "helm-release",
                  "postgresql",
                  "db"
                ]
              },
              {
                "typeInstanceName": "db",
                "uses": [
                  "postgresql"
                ]
              }
            ]
          },
          "implements": [
            {
              "path": "cap.interface.productivity.jira.install",
              "revision": "0.1.0"
            },
            {
              "path": "cap.interface.productivity.jira.install",
              "revision": "0.2.0"
            }
          ],
          "imports": [
            {
              "interfaceGroupPath": "cap.interface.runner.argo",
              "alias": "argo",
              "appVersion": "1.0",
              "methods": [
                {
                  "name": "run",
                  "revision": "0.1.0"
                }
              ]
            },
            {
              "path": "cap.interface.runner.helm",
              "alias": "helm",
              "appVersion": "3.0",
              "methods": [
                {
                  "name": "run",
                  "revision": "0.1.0"
                }
              ]
            }
          ],
          "requires": [
            {
              "prefix": "cap.core.type.platform",
              "oneOf": [
                {
                  "typeRef": {
                    "path": "cap.core.type.platform.kubernetes",
                    "revision": "0.1.0"
                  },
                  "valueConstraints": {
                    "version": ">=1.19.0"
                  }
                }
              ]
            }
          ]
        },
        "signature": {
          "och": "eyJ0eXAiOiJKV1QiLA0KICJhbGciOiJIUzI1NiJ9"
        }
      }
    ]
  },
  {
    "name": "update",
    "prefix": "cap.implementation.attlasian.jira",
    "path": "cap.implementation.attlasian.jira.update",
    "revisions": [
      {
        "metadata": {
          "description": "Action which updates Jira via Helm chart",
          "displayName": "Update Jira",
          "documentationURL": "https://github.com/javimox/helm-charts/tree/master/charts/jira-software",
          "iconURL": "https://www.atlassian.com/pl/dam/jcr:e33efd9e-e0b8-4d61-a24d-68a48ef99ed5/Jira%20Software@2x-blue.png",
          "maintainers": [
            {
              "name": "Voltron Dev Team",
              "email": "team-dev@projectvoltron.dev",
              "url": "https://projectvoltron.dev"
            }
          ],
          "name": "updated",
          "prefix": "cap.implementation.attlasian.jira",
          "path": "cap.implementation.attlasian.jira.update",
          "supportURL": " https://mox.sh/helm",
          "attributes": []
        },
        "revision": "0.1.0",
        "spec": {
          "action": {
            "runnerInterface": "argo.run",
            "args": {
              "workflow": {
                "entrypoint": "workflow",
                "templates": []
              }
            }
          },
          "appVersion": "8.x.x",
          "implements": [
            {
              "path": "cap.interface.productivity.jira.update",
              "revision": "0.1.0"
            }
          ],
          "imports": [
            {
              "path": "cap.interface.productivity.jira.install",
              "revision": "0.1.0"
            }
          ],
          "requires": [
            {
              "prefix": "cap.core.type.platform",
              "oneOf": [
                {
                  "typeRef": {
                    "path": "cap.core.type.platform.kubernetes",
                    "revision": "0.1.0"
                  },
                  "valueConstraints": {
                    "version": ">=1.19.0"
                  }
                }
              ]
            }
          ]
        },
        "signature": {
          "och": "eyJ0eXAiOiJKV1QiLA0KICJhbGciOiJIUzI1NiJ9"
        }
      }
    ]
  },
  {
    "name": "install-local",
    "prefix": "cap.implementation.attlasian.jira",
    "path": "cap.implementation.attlasian.jira.install-local",
    "revisions": [
      {
        "metadata": {
          "description": "Action which installs Jira via Helm chart",
          "displayName": "Install Jira",
          "documentationURL": "https://github.com/javimox/helm-charts/tree/master/charts/jira-software",
          "iconURL": "https://www.atlassian.com/pl/dam/jcr:e33efd9e-e0b8-4d61-a24d-68a48ef99ed5/Jira%20Software@2x-blue.png",
          "maintainers": [
            {
              "name": "Voltron Dev Team",
              "email": "team-dev@projectvoltron.dev",
              "url": "https://projectvoltron.dev"
            }
          ],
          "name": "install-local",
          "prefix": "cap.implementation.attlasian.jira",
          "path": "cap.implementation.attlasian.jira.install-local",
          "supportURL": " https://mox.sh/helm",
          "attributes": []
        },
        "revision": "0.1.0",
        "spec": {
          "action": {
            "runnerInterface": "cap.interface.runner.argo",
            "args": {
              "workflow": {
                "entrypoint": "jira",
                "templates": [
                  {
                    "name": "jira",
                    "steps": [
                      [
                        {
                          "name": "generate-artifacts",
                          "template": "fetch-type-instances"
                        }
                      ],
                      [
                        {
                          "name": "postgresql-install",
                          "template": "postgresql-install",
                          "arguments": {
                            "artifacts": [
                              {
                                "name": "postgresql-helm",
                                "from": "{{steps.generate-artifacts.outputs.artifacts.postgresql-helm}}"
                              }
                            ]
                          }
                        }
                      ],
                      [
                        {
                          "name": "produce-helm-values",
                          "template": "produce-helm-values",
                          "arguments": {
                            "artifacts": [
                              {
                                "name": "postgres",
                                "from": "{{steps.postgresql-install.outputs.artifacts.additional}}"
                              }
                            ]
                          }
                        }
                      ],
                      [
                        {
                          "name": "jira-install",
                          "template": "jira-install",
                          "arguments": {
                            "artifacts": [
                              {
                                "name": "jira-helm",
                                "from": "{{steps.generate-artifacts.outputs.artifacts.jira-helm}}"
                              }
                            ]
                          }
                        }
                      ],
                      [
                        {
                          "name": "upload-type-instances",
                          "template": "upload-type-instances",
                          "arguments": {
                            "artifacts": [
                              {
                                "name": "jira-output",
                                "from": "{{steps.jira-install.outputs.artifacts.additional}}"
                              }
                            ]
                          }
                        }
                      ]
                    ]
                  },
                  {
                    "name": "fetch-type-instances",
                    "container": {
                      "image": "gcr.io/projectvoltron/pr/voltron-helper:PR-136",
                      "imagePullPolicy": "Always"
                    },
                    "outputs": {
                      "artifacts": [
                        {
                          "name": "postgresql-helm",
                          "path": "/out/postgresql-input.yaml"
                        },
                        {
                          "name": "jira-helm",
                          "path": "/out/jira-helm-input.yaml"
                        }
                      ]
                    }
                  },
                  {
                    "name": "postgresql-install",
                    "container": {
                      "image": "gcr.io/projectvoltron/pr/helm-runner:PR-62",
                      "env": [
                        {
                          "name": "RUNNER_INPUT_PATH",
                          "value": "/input.yaml"
                        },
                        {
                          "name": "RUNNER_LOGGER_DEV_MODE",
                          "value": "true"
                        }
                      ]
                    },
                    "inputs": {
                      "artifacts": [
                        {
                          "name": "postgresql-helm",
                          "path": "/input.yaml"
                        }
                      ]
                    },
                    "outputs": {
                      "artifacts": [
                        {
                          "name": "release",
                          "path": "/release.yaml"
                        },
                        {
                          "name": "additional",
                          "path": "/additional.yaml"
                        }
                      ]
                    }
                  },
                  {
                    "name": "produce-helm-values",
                    "inputs": {
                      "artifacts": [
                        {
                          "name": "postgres",
                          "path": "/input.yaml"
                        }
                      ]
                    },
                    "container": {
                      "image": "gcr.io/projectvoltron/pr/voltron-helper:PR-136",
                      "command": [
                        "/produce-helm-cloud-values.sh"
                      ],
                      "args": [
                        "--input",
                        "postgresql={{`{{ inputs.artifacts.postgresql.path }}`}}",
                        "--input",
                        "params={{ inputParametersToArtifact.path }}",
                        "--output-path",
                        "{{`{{workflow.outputs.artifacts.postgresql}}`}}",
                        "--output-format",
                        "image:\n  tag: {{ .Context.appVersion }}\npostgresql:\n  enabled: false # do not install Postgres along the Jira installation\ndatabaseConnection:\n  host: {{`{{ .postgresql.host }}`}}\n  port: {{`{{ .postgresql.port }}`}}\n  user: {{`{{ .postgresql.superuser.username }}`}}\n  password: {{`{{ .postgresql.superuser.password }}`}}\n  database: {{`{{ .postgresql.defaultDBName }}`}}\ningress:\n  enabled: true\n  ingress:\n    hosts:\n      - host: {{`{{ .params.host }}`}}\n        paths: []\n"
                      ]
                    }
                  },
                  {
                    "name": "jira-install",
                    "container": {
                      "image": "gcr.io/projectvoltron/pr/helm-runner:PR-62",
                      "env": [
                        {
                          "name": "RUNNER_INPUT_PATH",
                          "value": "/input.yaml"
                        },
                        {
                          "name": "RUNNER_LOGGER_DEV_MODE",
                          "value": "true"
                        }
                      ]
                    },
                    "inputs": {
                      "artifacts": [
                        {
                          "name": "jira-helm",
                          "path": "/input.yaml"
                        }
                      ]
                    },
                    "outputs": {
                      "artifacts": [
                        {
                          "name": "release",
                          "path": "/release.yaml"
                        },
                        {
                          "name": "additional",
                          "path": "/additional.yaml"
                        }
                      ]
                    }
                  },
                  {
                    "name": "upload-type-instances",
                    "container": {
                      "image": "gcr.io/projectvoltron/pr/voltron-helper:PR-136",
                      "command": [
                        "/upload-type-instances.sh"
                      ],
                      "args": [
                        "helm"
                      ]
                    },
                    "inputs": {
                      "artifacts": [
                        {
                          "name": "jira-output",
                          "path": "/input.yaml"
                        }
                      ]
                    }
                  }
                ]
              }
            }
          },
          "appVersion": "8.x.x",
          "implements": [
            {
              "path": "cap.interface.productivity.jira.install-local",
              "revision": "0.1.0"
            }
          ],
          "imports": [
            {
              "interfaceGroupPath": "cap.interface.runner.argo",
              "alias": "argo",
              "appVersion": "1.0",
              "methods": [
                {
                  "name": "run",
                  "revision": "0.1.0"
                }
              ]
            },
            {
              "path": "cap.interface.runner.helm",
              "alias": "helm",
              "appVersion": "3.0",
              "methods": [
                {
                  "name": "run",
                  "revision": "0.1.0"
                }
              ]
            }
          ],
          "requires": [
            {
              "prefix": "cap.core.type.platform",
              "oneOf": [
                {
                  "typeRef": {
                    "path": "cap.core.type.platform.kubernetes",
                    "revision": "0.1.0"
                  },
                  "valueConstraints": {
                    "version": ">=1.19.0"
                  }
                }
              ]
            }
          ]
        },
        "signature": {
          "och": "eyJ0eXAiOiJKV1QiLA0KICJhbGciOiJIUzI1NiJ9"
        }
      }
    ]
  }
]
