# Generate documentation from JSONSchemas

This document describes the available open-source libraries that are able to generate the documentation for [JSON Schema draft-07](https://json-schema.org/draft-07/json-schema-release-notes.html).

## Table of Contents

<!-- toc -->

- [Motivation](#motivation)
- [Investigation](#investigation)
  * [`adobe/jsonschema2md`](#adobejsonschema2md)
    + [Example](#example)
    + [Generation](#generation)
    + [Pros](#pros)
    + [Cons](#cons)
  * [`CesiumGS/wetzel`](#cesiumgswetzel)
    + [Example](#example-1)
    + [Generation](#generation-1)
    + [Pros](#pros-1)
    + [Cons](#cons-1)
  * [`RalfG/jsonschema2md`](#ralfgjsonschema2md)
    + [Example](#example-2)
    + [Generation](#generation-2)
    + [Pros](#pros-2)
    + [Cons](#cons-2)
  * [`BrianWendt/json-schema-md-doc`](#brianwendtjson-schema-md-doc)
    + [Example](#example-3)
    + [Cons](#cons-3)
  * [`lbovet/docson`](#lbovetdocson)
    + [Example](#example-4)
    + [Cons](#cons-4)
  * [`coveooss/json-schema-for-humans`](#coveoossjson-schema-for-humans)
    + [Example](#example-5)
    + [Generation](#generation-3)
    + [Cons](#cons-5)
- [Decision](#decision)

<!-- tocstop -->

## Motivation

The [OCF entities](../../../ocf-spec/0.0.1/schema) are described using JSON Schemas draft-07. To improve our UX we want to generate documentation for them. In that way, we can maintain a single source of truth and also expose user-friendly specification documentation.

Desired documentation style: https://www.asyncapi.com/docs/specifications/2.0.0

## Investigation

This section contains the result of testing different libraries that generate documentation from JSON Schemas.

### `adobe/jsonschema2md`

Repository: https://github.com/adobe/jsonschema2md

Last release: v5.0.5 on Mar 20, 2021

Last update: Mar 20, 2021

#### Example

- Theirs: https://github.com/adobe/jsonschema2md/tree/main/examples/docs
- Ours: [adobe-jsonschema2md](./adobe-jsonschema2md)

#### Generation

> **NOTE:** Because this tool generated 60+ files, I leave only the Implementation entity, just to give an example.  
 
The [adobe-jsonschema2md](./adobe-jsonschema2md) content was generated by executing this command:

```bash
jsonschema2md -d ocf-spec/0.0.1/schema/ -o docs/investigation/doc-from-json-schema/adobe-jsonschema2md --schema-extension=json --example-format=yaml --skip  typesection -n --schema-out=-
```

#### Pros

- Supports JSONSchema draft-07.
- It is actively maintained.
- Supports **$ref** out-of-the-box, even if not exposed via HTTP server.

#### Cons

- Generates 60+ files for our schemas, and we are not able to configure it so that each schema is in a single file. As a result, we have files named like `implementation-properties-metadata-allof-1-properties-license-oneof-0-properties-name.md`.
- Not all files are generated, but we also do not get any error. For example, for [`implementation.md`](./adobe-jsonschema2md/implementation.md) the `implementation-properties-spec.md` was not generated. Needs to be investigated further.
- It duplicates information. For example, [`implementation.md`](./adobe-jsonschema2md/implementation.md) has a full definition for the `name` type, but we also have [`implementation-definitions-requireentity-properties-name.md`](./adobe-jsonschema2md/implementation-definitions-requireentity-properties-name.md), which duplicates this information.
- The shared metadata is generated as a single `.md` file, but others files refer to `attribute-properties-ocf-metadata.md` instead of `metadata.md`. Needs to be investigated further.  
- **[minor]** The `title` property needs to be added, otherwise it generates it as `Untitled schema`.

### `CesiumGS/wetzel`

Repository: https://github.com/CesiumGS/wetzel

Last release: 0.1.0-dev.1.5 on Dec 3, 2020

Last update: Dec 3, 2020

#### Example

- Theirs: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#properties-reference
- Ours: [wetzel](./wetzel)

#### Generation

The [wetzel](./wetzel) content was generated by executing this command:

```bash
wetzel ocf-spec/0.0.1/schema/attribute.json  -l 2 > ./docs/investigation/doc-from-json-schema/wetzel/attribute.md
wetzel ocf-spec/0.0.1/schema/interface.json  -l 2 > ./docs/investigation/doc-from-json-schema/wetzel/interface.md
wetzel ocf-spec/0.0.1/schema/interface-group.json  -l 2 > ./docs/investigation/doc-from-json-schema/wetzel/interface-group.md
wetzel ocf-spec/0.0.1/schema/repo-metadata.json  -l 2 > ./docs/investigation/doc-from-json-schema/wetzel/repo-metadata.md
wetzel ocf-spec/0.0.1/schema/repo-metadata.json  -l 2 > ./docs/investigation/doc-from-json-schema/wetzel/repo-metadata.md
wetzel ocf-spec/0.0.1/schema/type.json  -l 2 > ./docs/investigation/doc-from-json-schema/wetzel/type.md
wetzel ocf-spec/0.0.1/schema/type.json  -l 2 > ./docs/investigation/doc-from-json-schema/wetzel/type.md
wetzel ocf-spec/0.0.1/schema/vendor.json  -l 2 > ./docs/investigation/doc-from-json-schema/wetzel/vendor.md

# implementation not supported, error: Error: Unable to find $ref #/definitions/requireEntity
# wetzel ocf-spec/0.0.1/schema/implementation.json  -l 2 > ./docs/investigation/doc-from-json-schema/wetzel/implementation.md
```

#### Pros

- Generates a single file per JSON Schema.
- Returns readable and helpful errors messages.

#### Cons

- Supports only local `$ref`. Doesn't support `http` refs, or even [definition reference](https://json-schema.org/understanding-json-schema/structuring.html#reuse): `Error: Unable to find $ref #/definitions/requireEntity`.
- Supports the Draft-3 and Draft-4. We use Draft-7.
- Supports parsing a single schema at a time.
- **[minor]** The `title` property needs to be added, otherwise it generates it as `WETZEL_WARNING: title not defined.xxx`.

### `RalfG/jsonschema2md`

Repository: https://github.com/RalfG/jsonschema2md

Last release: v0.1.1 on Aug 31, 2020

Last update: Sep 2, 2020

#### Example

- Theirs: https://github.com/RalfG/jsonschema2md/tree/master/examples
- Ours: [ralfg-jsonschema2md](./ralfg-jsonschema2md)

#### Generation

The [ralfg-jsonschema2md](./ralfg-jsonschema2md) content was generated by executing this command:

```bash
jsonschema2md ocf-spec/0.0.1/schema/attribute.json ./docs/investigation/doc-from-json-schema/ralfg-jsonschema2md/attribute.md
jsonschema2md ocf-spec/0.0.1/schema/interface.json ./docs/investigation/doc-from-json-schema/ralfg-jsonschema2md/interface.md
jsonschema2md ocf-spec/0.0.1/schema/interface-group.json ./docs/investigation/doc-from-json-schema/ralfg-jsonschema2md/interface-group.md
jsonschema2md ocf-spec/0.0.1/schema/repo-metadata.json ./docs/investigation/doc-from-json-schema/ralfg-jsonschema2md/repo-metadata.md
jsonschema2md ocf-spec/0.0.1/schema/repo-metadata.json ./docs/investigation/doc-from-json-schema/ralfg-jsonschema2md/repo-metadata.md
jsonschema2md ocf-spec/0.0.1/schema/type.json ./docs/investigation/doc-from-json-schema/ralfg-jsonschema2md/type.md
jsonschema2md ocf-spec/0.0.1/schema/type.json ./docs/investigation/doc-from-json-schema/ralfg-jsonschema2md/type.md
jsonschema2md ocf-spec/0.0.1/schema/vendor.json ./docs/investigation/doc-from-json-schema/ralfg-jsonschema2md/vendor.md
jsonschema2md ocf-spec/0.0.1/schema/implementation.json ./docs/investigation/doc-from-json-schema/ralfg-jsonschema2md/implementation.md
```

#### Pros

- Generates a single file per JSON Schema.

#### Cons

- The generated documentation is really simple. For example, it doesn't add information if something is required or not.
- Doesn't support inlining the **$ref** definition.
- Supports a single schema at a time.
- For the Implementation entity, the `metadata` property was not resolved properly.

### `BrianWendt/json-schema-md-doc`

Repository: https://github.com/BrianWendt/json-schema-md-doc

Last update: Jan 26, 2021

#### Example

- Theirs: https://github.com/BrianWendt/json-schema-md-doc/blob/master/samples/node/schema.md
- Own: [json-schema-md-doc](./json-schema-md-doc)

#### Cons

- No CLI.
- Doesn't generate user-friendly documentation.

### `lbovet/docson`

Repository: https://github.com/lbovet/docson

Last release: v2.1.0 on Aug 8, 2018

Last update:  Mar 14, 2020

#### Example

- Theirs: https://lbovet.github.io/docson/index.html#/docson/examples/example.json
- Ours: ![](./assets/docson.png)

#### Cons

- Package was published 3 years ago.
- Doesn't support **$ref**.
- Supports the Draft-4, we use Draft-7.
- Doesn't generate `.md` files, serves content in a browser. Node.js server is required.
- Doesn't have an option to see all exposed schemas. You need to use a single URL per schema.

### `coveooss/json-schema-for-humans`

Repository: https://github.com/coveooss/json-schema-for-humans

Last release: v0.31.0 on Feb 22, 2021

Last update:  on Feb 22, 2021             

#### Example

- Theirs: https://coveooss.github.io/json-schema-for-humans/
- Ours: [json-schema-for-humans](./json-schema-for-humans/schema_doc.html)

#### Generation

```bash
generate-schema-doc ocf-spec/0.0.1/schema/attribute.json
```

#### Cons

- Supports a single schema at a time.
- Doesn't generate `.md` files, serves content in a browser.
- Doesn't have an option to see all exposed schemas. You need to use a single URL per schema.


## Decision

Unfortunately, none of the tested solutions fulfill our requirements out-of-the-box and produce human-readable documentation which would improve the UX. As a result, we decided not to implement automated documentation generation.

The manual maintenance of the JSON schema documentation is widely practiced in the community, for example in [Serverless Workflow Specification](https://github.com/serverlessworkflow/specification) or [AsyncAPI](https://www.asyncapi.com/docs).

In the future, we will get user feedback, and we will come back to this topic and decide if we should invest our time in creating/contributing to a tool which would generate a desired documentation style, or use a hybrid approach where basic documentation is generated and all necessary changes are applied manually.
