apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "voltron.fullname" . }}-test-e2e"
  labels:
  {{- include "voltron.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test-success
spec:
  containers:
    - name: tests-runner
      image: "{{ .Values.global.containerRegistry.path }}/{{ .Values.integrationTest.image.name }}:{{ .Values.global.containerRegistry.overrideTag | default .Chart.AppVersion }}"
      env:
        - name: STATUS_ENDPOINTS
          value: "http://voltron-engine-graphql.{{.Release.Namespace}}.svc.cluster.local/healthz,http://voltron-gateway.{{.Release.Namespace}}.svc.cluster.local/healthz,http://voltron-och-local.{{.Release.Namespace}}.svc.cluster.local/healthz,http://voltron-och-public.{{.Release.Namespace}}.svc.cluster.local/healthz"
      command:
        - /app
      args:
        - "-test.v"
      imagePullPolicy: {{ .Values.integrationTest.image.pullPolicy }}
  restartPolicy: Never
