ocfVersion: 0.0.1
revision: 0.1.0
kind: Type
metadata:
  name: run-input
  prefix: cap.type.runner.cloudsql  # Computed during fetching the manifest
  displayName: Input parameters for Run action
  description: Describes input parameters for Run action of the Google Cloud Platform CloudSQL Runner.
  documentationURL: https://cloud.google.com/sdk/gcloud/reference/sql
  supportURL: https://cloud.google.com
  maintainers:
    - email: team-dev@projectvoltron.dev
      name: Voltron Dev Team
      url: https://projectvoltron.dev

spec:
  # TODO improve the .args.instance JSON schema, after we know inputs for other commands
  jsonSchema:
    value: |-
      {
        "$schema": "http://json-schema.org/draft-07/schema",
        "type": "object",
        "title": "The input schema for Google Cloud Platform Runner",
        "examples": [
          {
            "context": {
              "platform": {
                "foo": "bar"
              },
              "name": "foo",
              "dryRun": false
            },
            "args": {
              "group": "sql",
              "command": "create",
              "generateName": true,
              "instance": {
                "tier": "db-g1-small",
                "databaseVersion": "POSTGRES_12",
                "region": "us-central"
              }
            }
          }
        ],
        "required": [
            "context",
            "args"
        ],
        "properties": {
          "context": {
            "$id": "#/properties/context",
            "type": "object",
            "title": "Runner context",
            "required": [ "dryRun", "name" ],
            "properties": {
              "dryRun": {
                  "$id": "#/properties/context/properties/dryRun",
                  "type": "boolean",
                  "title": "Describes if the action should test ability to execute, not actually execute",
                  "default": false
              },
              "name": {
                  "$id": "#/properties/context/properties/name",
                  "type": "string",
                  "title": "Describes the name of current run"
              },
              "platform": {
                  "$id": "#/properties/context/properties/platform",
                  "type": "object",
                  "additionalProperties": true,
                  "default": {},
                  "title": "Describes platform-specific values"
              }
            },
            "additionalProperties": false
          },
          "args": {
            "$id": "#/properties/args",
            "type": "object",
            "title": "Arguments for Helm Runner",
            "additionalProperties": false,
            "required": [
                "group",
                "command",
                "configuration",
                "output"
            ],
            "properties": {
              "group": {
                "$id": "#/properties/args/properties/group",
                "type": "string",
                "title": "The group of a command"
              },
              "command": {
                "$id": "#/properties/args/properties/command",
                "type": "string",
                "title": "The command to execute"
              },
              "generateName": {
                "$id": "#/properties/args/properties/generateName",
                "type": "boolean",
                "title": "Generate instance name",
                "default": false
              },
              "instance": {
                "$id": "#/properties/args/properties/instance",
                "type": "object",
                "title": "CloudSQL instance parameters",
                "description": "This field can have the content defined in https://cloud.google.com/sql/docs/mysql/admin-api/rest/v1beta4/instances"
                "additionalProperties": true
              },
              "output": {
                "$id": "#/properties/args/properties/output",
                "type": "object",
                "title": "The parameters for output files",
                "additionalProperties": false,
                "required": ["directory", "cloudSQLInstance"],
                "properties": {
                  "directory": {
                    "$id": "#/properties/args/properties/output/properties/directory",
                    "type": "string",
                    "title": "Directory for the output files"
                  },
                  "cloudSQLInstance": {
                    "$id": "#/properties/args/properties/output/properties/cloudSQLInstance",
                    "type": "object",
                    "title": "Parameters for the CloudSQL instance (cap.type.gcp.cloudsql) output file",
                    "additionalProperties": false,
                    "required": [
                        "fileName"
                    ],
                    "properties": {
                      "fileName": {
                        "$id": "#/properties/args/properties/output/properties/cloudSQLInstance/properties/fileName",
                        "type": "string",
                        "title": "The file name of the CloudSQLInstance output file"
                      }
                    }
                  },
                  "additional": {
                    "$id": "#/properties/args/properties/output/properties/additional",
                    "type": "object",
                    "title": "The parameters for additional output file",
                    "additionalProperties": false,
                    "required": [
                        "value",
                        "fileName"
                    ],
                    "properties": {
                      "value": {
                        "$id": "#/properties/args/properties/output/properties/additional/properties/value",
                        "type": "object",
                        "title": "The shape for additional output file",
                        "additionalProperties": true
                      },
                      "fileName": {
                        "$id": "#/properties/args/properties/output/properties/additional/properties/fileName",
                        "type": "string",
                        "title": "The file name of the output file"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "additionalProperties": false
      }

signature:
  och: eyJ0eXAiOiJKV1QiLA0KICJhbGciOiJIUzI1NiJ9
