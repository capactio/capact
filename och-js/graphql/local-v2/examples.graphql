# This file contains example GraphQL operations for Local OCH.
# How to use it: Copy and paste the full content to GraphQL Playground or external GraphQL client.

# To use all queries without specifying your own variables, use the JSON from `examples.variables.json` file.

mutation CreateTypeInstance {
  createTypeInstance(
    in: {
      typeRef: { path: "cap.type.sample", revision: "0.1.0" }
      value: { hello: "world" }
      attributes: [{ path: "cap.attribute.sample", revision: "0.1.0" }]
    }
  ) {
    ...TypeInstance
  }
}

mutation CreateTypeInstances {
  createTypeInstances(
    in: {
      typeInstances: [
        {
          alias: "child"
          typeRef: { path: "cap.type.simple", revision: "0.1.0" }
          attributes: [{ path: "cap.attribute.sample", revision: "0.1.0" }]
          value: { name: "Luke Skywalker" }
        }
        {
          alias: "parent"
          typeRef: { path: "cap.type.simple", revision: "0.1.0" }
          attributes: [{ path: "cap.attribute.sample", revision: "0.1.0" }]
          value: { name: "Darth Vader" }
        }
      ]
      usesRelations: [{ from: "parent", to: "child" }]
    }
  ) {
    id
    alias
  }
}

# Example variables: {"typeInstanceID": "288fe1fa-dea1-42ee-91d2-f2c7e98a9ad4"}
query GetTypeInstance($typeInstanceID: ID!) {
  typeInstance(id: $typeInstanceID) {
    ...TypeInstance
  }
}

# Lists TypeInstances.
query ListTypeInstances {
  typeInstances {
    ...TypeInstance
  }
}

query ListTypeInstancesWithTypeRefFilter {
  typeInstances(
    filter: { typeRef: { path: "cap.type.sample", revision: "0.1.0" } }
  ) {
    ...TypeInstance
  }
}

query ListTypeInstancesWithAttributesAndTypeRefFilter {
  typeInstances(
    filter: {
      attributes: [
        { path: "cap.attribute.sample", revision: "1.0.0", rule: INCLUDE }
        { path: "cap.attribute.foo", revision: "1.0.0", rule: EXCLUDE }
      ]
      typeRef: { path: "cap.type.sample", revision: "0.1.0" }
    }
  ) {
    ...TypeInstance
  }
}

query ListTypeInstancesWithUsesAndUsedByProperties {
  typeInstances {
    ...TypeInstanceWithUses
  }
}

# Example variables: {"typeInstanceID": "288fe1fa-dea1-42ee-91d2-f2c7e98a9ad4"}
mutation UpdateTypeInstance($typeInstanceID: ID!) {
  updateTypeInstance(
    id: $typeInstanceID
    in: {
      resourceVersion: 3
      value: { foo: "bar" }
      typeRef: { path: "cap.type.sample", revision: "0.1.0" }
      attributes: [
        { path: "cap.attribute.foo", revision: "0.1.1" }
        { path: "cap.attribute.bar", revision: "1.0.0" }
      ]
    }
  ) {
    ...TypeInstance
  }
}

# Example variables: {"typeInstanceID": "288fe1fa-dea1-42ee-91d2-f2c7e98a9ad4", "secondTypeInstanceID": "5977174e-ae64-4571-aecf-cca9cbac5756"}
mutation UpdateTypeInstances($typeInstanceID: ID!, $secondTypeInstanceID: ID!) {
  updateTypeInstances(
    in: [
      {
        id: $typeInstanceID
        typeInstance: {
          typeRef: { path: "cap.type.sample", revision: "0.1.0" }
          attributes: [{ path: "cap.attribute.sample", revision: "0.1.0" }]
          value: { name: "Luke Skywalker" }
          resourceVersion: 1
        }
      }
      {
        id: $secondTypeInstanceID
        typeInstance: {
          typeRef: { path: "cap.type.sample", revision: "0.1.0" }
          attributes: [{ path: "cap.attribute.sample", revision: "0.1.0" }]
          value: { name: "Darth Vader" }
          resourceVersion: 1
        }
      }
    ]
  ) {
    id
    resourceVersions {
      ...TypeInstanceResourceVersion
    }
  }
}

# Example variables: {"typeInstanceID": "288fe1fa-dea1-42ee-91d2-f2c7e98a9ad4"}
mutation DeleteTypeInstance($typeInstanceID: ID!) {
  deleteTypeInstance(id: $typeInstanceID)
}

#
# Fragments with all possible fields for Local OCH entities
#

fragment TypeInstance on TypeInstance {
  id
  typeRef {
    path
    revision
  }

  latestResourceVersion {
    ...TypeInstanceResourceVersion
  }

  firstResourceVersion {
    ...TypeInstanceResourceVersion
  }

  previousResourceVersion {
    ...TypeInstanceResourceVersion
  }

  resourceVersions {
    ...TypeInstanceResourceVersion
  }

  resourceVersion(resourceVersion: 1) {
    ...TypeInstanceResourceVersion
  }
}

fragment TypeInstanceResourceVersion on TypeInstanceResourceVersion {
  resourceVersion
  metadata {
    attributes {
      path
      revision
    }
  }
  spec {
    value
  }
}

fragment TypeInstanceWithUses on TypeInstance {
  ...TypeInstance
  uses {
    ...TypeInstance
  }
  usedBy {
    ...TypeInstance
  }
}
